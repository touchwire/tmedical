<?php

namespace Touchwire\Entity\Repository;

use Touchwire\Entity\Profile;

use Doctrine\ORM\EntityRepository,
	Touchwire\Entity\User;

/**
 * UserRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class UserRepository extends EntityRepository
{
	public function saveUser(User $user, $values){
		
		$user->setUsername($values['username']);
		$user->setPassword($values['password']);
		
		//add profile -- refactor me
		$p = new Profile();
		$p->setFirstname($values['firstname']);
		$p->setLastname($values['lastname']);
		$p->setGender($values['gender']);
		$p->setEmail($values['email']);
		$p->setPhone($values['phone']);
		$p->setAddress($values['address']);
		
		$user->setProfile($p);
		
		$this->getEntityManager()->persist($user);
	}
	
	public function updateUser(User $user, $values){
		$em = $this->getEntityManager();
		$proxy = $em->find('Touchwire\entity\User', array('profile_id' => $values['id']));
		//$proxy = $em->getReference('\Touchwire\Entity\User', $values['id']); //refence profile id
		$p = new Profile();
		$p->setFirstname($values['firstname']);
		$p->setLastname($values['lastname']);
		$p->setGender($values['gender']);
		$p->setEmail($values['email']);
		$p->setPhone($values['phone']);
		$p->setAddress($values['address']);
		
		$proxy->setProfile($p);
		$proxy->setUpdated();
		$this->getEntityManager()->persist($proxy);
	}
	
	public function removeUser($id){
		$em = $this->getEntityManager();
		$proxy = $em->getReference('\Touchwire\Entity\User', $id);
		
		$em->remove($proxy);		
	}
}